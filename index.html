<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#005599" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="FishTranslate" />
  <title>FishTranslate</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body {
      min-height: 100vh;
      background: linear-gradient(160deg, #081420 0%, #0c1e30 60%, #081828 100%);
      font-family: 'Segoe UI', system-ui, sans-serif;
      color: #e8f4fd;
    }
    #app { max-width: 480px; margin: 0 auto; }

    /* Header */
    .header {
      background: linear-gradient(90deg, #005599 0%, #0088bb 100%);
      padding: 22px 16px 18px;
      box-shadow: 0 4px 24px rgba(0,85,153,0.6);
      text-align: center;
    }
    .header-icon { font-size: 34px; margin-bottom: 2px; }
    .header h1 { font-size: 23px; font-weight: 800; letter-spacing: 1.5px; color: #fff; }
    .header p { margin-top: 5px; font-size: 12px; color: rgba(255,255,255,0.75); }

    /* Search box */
    .search-wrap { padding: 18px 14px 0; }
    .search-box {
      background: rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(0,136,187,0.3);
    }
    .search-label { font-size: 11px; color: #7ec8e3; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
    .search-row { display: flex; gap: 8px; }
    #search-input {
      flex: 1;
      background: rgba(255,255,255,0.09);
      border: 1px solid rgba(0,136,187,0.4);
      border-radius: 10px;
      padding: 12px 14px;
      color: #fff;
      font-size: 16px;
      outline: none;
    }
    #search-input::placeholder { color: rgba(255,255,255,0.35); }
    .btn-search, .btn-clear {
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      font-size: 20px;
      cursor: pointer;
    }
    .btn-search {
      background: linear-gradient(135deg, #005599, #0088bb);
      color: #fff;
      box-shadow: 0 4px 14px rgba(0,85,153,0.5);
    }
    .btn-clear {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15) !important;
      color: #aaa;
      font-size: 16px;
    }

    /* Output */
    .output { padding: 14px; }

    /* Loading */
    .loading-card {
      background: rgba(255,165,0,0.07);
      border: 1px solid rgba(255,165,0,0.25);
      border-radius: 14px;
      padding: 22px 16px;
      text-align: center;
    }
    .loading-card .icon { font-size: 30px; margin-bottom: 10px; }
    .loading-card .title { color: #ffcc44; font-weight: 700; font-size: 15px; }
    .loading-card .sub { color: #886600; font-size: 12px; margin-top: 4px; }
    .progress-bar { margin-top: 16px; height: 3px; background: rgba(255,255,255,0.08); border-radius: 2px; overflow: hidden; }
    .progress-inner {
      height: 100%; width: 45%;
      background: linear-gradient(90deg, transparent, #ffcc44, transparent);
      border-radius: 2px;
      animation: shimmer 1.4s infinite linear;
    }
    @keyframes shimmer { 0%{transform:translateX(-200%)} 100%{transform:translateX(500%)} }

    /* Result card */
    .ai-badge {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 10px; padding: 10px 14px;
      background: rgba(255,170,0,0.1);
      border: 1px solid rgba(255,170,0,0.3);
      border-radius: 10px;
    }
    .ai-badge-icon { font-size: 20px; }
    .ai-badge-title { font-size: 13px; font-weight: 700; color: #ffcc44; }
    .ai-badge-sub { font-size: 11px; color: #997700; }

    .result-table {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .result-table.db { background: rgba(0,153,204,0.08); border: 1px solid rgba(0,153,204,0.3); }
    .result-table.ai { background: rgba(255,170,0,0.05); border: 1px solid rgba(255,170,0,0.25); }
    .result-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 13px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .result-row:last-child { border-bottom: none; }
    .result-row:nth-child(odd) { background: rgba(255,255,255,0.02); }
    .result-lang { font-size: 14px; min-width: 130px; }
    .result-lang.db { color: #7ec8e3; }
    .result-lang.ai { color: #ccaa44; }
    .result-name { font-size: 15px; font-weight: 600; color: #e8f4fd; text-align: right; flex: 1; }
    .result-name.empty { color: #444; }

    /* Multiple */
    .multi-label { color: #7ec8e3; font-size: 12px; margin-bottom: 10px; }
    .multi-item {
      background: rgba(0,136,187,0.08);
      border: 1px solid rgba(0,136,187,0.25);
      border-radius: 12px;
      padding: 13px 16px;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .multi-item:active { background: rgba(0,136,187,0.18); }
    .multi-item-name { font-weight: 700; font-size: 15px; }
    .multi-item-sub { font-size: 12px; color: #7ec8e3; margin-top: 2px; }

    /* Error / not found */
    .msg-card {
      border-radius: 14px;
      padding: 20px 16px;
      text-align: center;
    }
    .msg-card.red { background: rgba(255,70,70,0.08); border: 1px solid rgba(255,70,70,0.25); }
    .msg-card .icon { font-size: 28px; margin-bottom: 8px; }
    .msg-card .title { font-weight: 600; }
    .msg-card.red .title { color: #ff9999; }
    .msg-card .sub { font-size: 12px; margin-top: 4px; }
    .msg-card.red .sub { color: #994444; }

    /* Fish list */
    .list-label { color: #7ec8e3; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; margin-top: 6px; }
    .fish-item {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.07);
      border-radius: 10px;
      padding: 11px 14px;
      margin-bottom: 5px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .fish-item:active { background: rgba(255,255,255,0.07); }
    .fish-item-name { font-weight: 600; font-size: 15px; }
    .fish-item-en { font-size: 12px; color: #7ec8e3; margin-top: 1px; }
    .fish-item-arrow { color: #0088bb; font-size: 20px; }

    .hidden { display: none !important; }
  </style>
</head>
<body>
<div id="app">
  <!-- Header -->
  <div class="header">
    <div class="header-icon">üêü</div>
    <h1>FishTranslate</h1>
    <p>7 jƒôzyk√≥w ¬∑ lokalna baza + wyszukiwanie AI</p>
  </div>

  <!-- API Key -->
  <div class="search-wrap" style="padding-bottom:0">
    <div class="search-box" style="border-color:rgba(255,170,0,0.3)">
      <div class="search-label" style="color:#ffcc44">üîë Klucz API Anthropic (do wyszukiwania AI)</div>
      <input id="api-key-input" type="password" placeholder="sk-ant-api03-..." autocomplete="off" style="width:100%;background:rgba(255,255,255,0.09);border:1px solid rgba(255,170,0,0.4);border-radius:10px;padding:10px 14px;color:#fff;font-size:14px;outline:none;" />
      <div style="font-size:11px;color:#886600;margin-top:6px">Potrzebny tylko gdy ryby nie ma w lokalnej bazie. Klucz nie jest nigdzie wysy≈Çany ‚Äî zostaje tylko w Twojej przeglƒÖdarce.</div>
    </div>
  </div>

  <!-- Search -->
  <div class="search-wrap">
    <div class="search-box">
      <div class="search-label">Nazwa ryby (dowolny jƒôzyk)</div>
      <div class="search-row">
        <input id="search-input" type="text" placeholder="Torsk, Cod, Morue, Dorsch, Bacalao..." autocomplete="off" autocorrect="off" spellcheck="false" />
        <button class="btn-search" id="btn-search" onclick="doSearch()">üîç</button>
        <button class="btn-clear hidden" id="btn-clear" onclick="doReset()">‚úï</button>
      </div>
    </div>
  </div>

  <!-- Output -->
  <div class="output">

    <!-- Loading -->
    <div class="loading-card hidden" id="state-loading">
      <div class="icon">üåä</div>
      <div class="title">Szukam...</div>
      <div class="sub">sprawdzam bazƒô i internet</div>
      <div class="progress-bar"><div class="progress-inner"></div></div>
    </div>

    <!-- Found in DB -->
    <div class="hidden" id="state-found">
      <div class="result-table db" id="result-db"></div>
    </div>

    <!-- Found via AI -->
    <div class="hidden" id="state-ai-found">
      <div class="ai-badge">
        <div class="ai-badge-icon">üåê</div>
        <div>
          <div class="ai-badge-title">Wynik z wyszukiwania AI</div>
          <div class="ai-badge-sub">Ryby nie by≈Ço w lokalnej bazie</div>
        </div>
      </div>
      <div class="result-table ai" id="result-ai"></div>
    </div>

    <!-- Multiple -->
    <div class="hidden" id="state-multiple">
      <div class="multi-label">Kilka wynik√≥w ‚Äî wybierz rybƒô:</div>
      <div id="multi-list"></div>
    </div>

    <!-- Not found -->
    <div class="msg-card red hidden" id="state-not-found">
      <div class="icon">üîç</div>
      <div class="title">Nie ma w bazie</div>
      <div class="sub">Wy≈õlij tƒô nazwƒô do nas ‚Äî dodamy jƒÖ do bazy w nastƒôpnej aktualizacji</div>
    </div>

    <!-- Error -->
    <div class="msg-card red hidden" id="state-error">
      <div class="icon">‚ö†Ô∏è</div>
      <div class="title">Nie znaleziono ryby</div>
      <div class="sub">Sprawd≈∫ pisowniƒô lub spr√≥buj innej nazwy</div>
    </div>

    <!-- Idle: fish list -->
    <div id="state-idle">
      <div class="list-label">Lokalna baza ¬∑ <span id="fish-count"></span> ryb</div>
      <div id="fish-list"></div>
    </div>

  </div>
</div>

<script>
const FISH_DB = [
  // --- Ze zdjƒôcia (oryginalna baza) ---
  { no: "Bl√•kveite", fr: "Fl√©tan noir", en: "Greenland Halibut", de: "Schwarzer Heilbutt", da: "Hellefisk", es: "Lipogloso negro", pt: "Alabote-da-Gronel√¢ndia" },
  { no: "Breiflabb", fr: "Lotte", en: "Anglerfish", de: "Seeteufel", da: "Havtaske/Bredflabb", es: "Rape", pt: "Tamboril" },
  { no: "Breiflabb m/hode", fr: "Lotte avec t√™te", en: "Anglerfish w/head", de: "Seeteufel m/kopf", da: "Havtaske m/hoved", es: "Rape con la pista", pt: "Tamboril com cabe√ßa" },
  { no: "Breiflabbhaler", fr: "Queue de Lotte", en: "Anglerfishtails", de: "Seeteufel o/kopf", da: "Havtaskehaler", es: "Colas del rape", pt: "Cauda do Tamboril" },
  { no: "Flyndre", fr: "Plie", en: "Plaice", de: "Butt", da: "Solla", es: "Solla", pt: "Solha" },
  { no: "Gr√•steinbit", fr: "Loup de mer", en: "Wolffish", de: "Katfisch", da: "Havkat", es: "Perro del norte, lobo", pt: "Gata" },
  { no: "Hyse", fr: "Eglefin", en: "Haddock", de: "Schellfisch", da: "Kuller", es: "Eglefino", pt: "Arinca, Eglefim" },
  { no: "Hyse m/hode", fr: "Eglefin avec t√™te", en: "Haddock w/head", de: "Schellfisch m/kopf", da: "Kuller m/hoved", es: "Eglefino con la pista", pt: "Arinca, Eglefim com cabe√ßa" },
  { no: "Hyse u/hode", fr: "Eglefin sans t√™te", en: "Haddock wo/head", de: "Schellfisch o/kopf", da: "Kuller u/hoved", es: "Eglefino sin la pista", pt: "Arinca, Eglefim sem cabe√ßa" },
  { no: "Hyse, sl√∏yd", fr: "Eglefin vid√©", en: "Haddock, gutted", de: "Schellfisch ausgeweidet", da: "Kuller", es: "Eglefine, destripado", pt: "Arinca, Eglefim" },
  { no: "H√•", fr: "Requin-taupe commun", en: "Porbeagle", de: "Heringshai", da: "Sildehaj", es: "Cail√≥n marrajo", pt: "Anequim" },
  { no: "H√•brand", fr: "Requin-taupe commun", en: "Porbeagle", de: "Heringshai", da: "Sildehaj", es: "Cail√≥n marrajo", pt: "Anequim" },
  { no: "H√•brann", fr: "Requin-taupe commun", en: "Porbeagle", de: "Heringshai", da: "Sildehaj", es: "Cail√≥n marrajo", pt: "Anequim" },
  { no: "Kveite", fr: "Fl√©tan d'Atlantique", en: "Atlantic halibut", de: "Heilbutt", da: "Helleflyndre", es: "Halibut, fletan", pt: "Alabote" },
  { no: "Laks", fr: "Saumon", en: "Salmon", de: "Lachs", da: "Laks", es: "Salm√≥n", pt: "Salm√£o" },
  { no: "Laksefillet", fr: "Filet de saumon", en: "Fillet of salmon", de: "Leiste von lachs", da: "Laksefilet", es: "Filete de salm√≥n", pt: "Filete de salm√£o" },
  { no: "Lyr", fr: "Lieu Jaune", en: "Pollack", de: "Pollack", da: "Lubbe", es: "Abadejo", pt: "Badejo" },
  { no: "Lyrfilet", fr: "Filet de Lieu jaune", en: "Fillet of Pollack", de: "Leiste von Pollack", da: "Lubefilet", es: "Abadejo", pt: "Badejo" },
  { no: "Lysing", fr: "Merlu", en: "Hake", de: "Seehecht", da: "Kulmule", es: "Merluza", pt: "Merl√∫cio" },
  { no: "Piggh√•", fr: "Aiguillat cubain", en: "Picked Dogfish", de: "Dornhai", da: "Haj", es: "Galludo", pt: "Galhudo, Esquato" },
  { no: "Piggvar", fr: "Turbot", en: "Turbot", de: "Steinbutt", da: "Pighvarre", es: "Rodaballo", pt: "Pregado" },
  { no: "R√∏dspette", fr: "Carrelet (Plie)", en: "Plaice", de: "Goldbutt", da: "R√∏dsp√¶tte", es: "Solla", pt: "Solha" },
  { no: "Sei", fr: "Lieu Noir", en: "Saithe/Coalfish", de: "K√∂hler", da: "Sej", es: "Palero", pt: "Escamudo" },
  { no: "Sild", fr: "Hareng commun", en: "Herring", de: "Hering", da: "Sild", es: "Arenque", pt: "Arenque" },
  { no: "Sildefilet", fr: "Filet de hareng", en: "Fillet of Herring", de: "Leiste von Hering", da: "Sildefilet", es: "Filete de arenque", pt: "Filete de arenque" },
  { no: "Skate", fr: "Ra√Ø√©e", en: "Ray", de: "Rochen", da: "Skade", es: "Raya", pt: "Airaga" },
  { no: "Steinbit", fr: "Loup de mer", en: "Wolffish", de: "Katfisch", da: "Havkat", es: "Perro del norte, lobo", pt: "Gata" },
  { no: "Torsk", fr: "Morue/Cabbilaud", en: "Cod", de: "Dorsch", da: "Torsk", es: "Bacalao", pt: "Bacalhau" },
  { no: "Uer", fr: "Sebast√©", en: "Redfish", de: "Rotbarsch", da: "R√∏dfisk", es: "Callineta n√≥rdica", pt: "Cantarilho" },
  { no: "Uer, rund", fr: "Sebast√©", en: "Redfish", de: "Rotbarsch", da: "R√∏dfisk", es: "Callineta n√≥rdica", pt: "Cantarilho" },
  { no: "Ulke", fr: "Lotte", en: "Anglerfish", de: "Seeteufel", da: "Havtaske", es: "Rape", pt: "Tamboril" },
  { no: "Ulke m/hode", fr: "Lotte avec t√™te", en: "Anglerfish w/ head", de: "Seeteufel m/kopf", da: "Havtaske m/hoved", es: "Rape con la pista", pt: "Tamboril com cabe√ßa" },
  { no: "Ulke m/hode og lever", fr: "Lotte avec t√™te et foie", en: "Anglerfish w/head & liver", de: "Seetefel m/kopf & leber", da: "Havtaske m/hoved & lever", es: "Rape con la pista & higado", pt: "Tamboril com figado" },
  { no: "Ulkehaler", fr: "Queue sw Lotte", en: "Anglerfishtails", de: "Seeteufel", da: "Havtaskehaler", es: "Colas del rape", pt: "Cauda del Tamboril" },
  { no: "Ulkelever", fr: "Foie de Lotte", en: "Liver of anglerfish", de: "Leber von seeteufel", da: "Havtaskelever", es: "Higado del rape", pt: "Figado del tamboril" },
  { no: "Vinger (Skate)", fr: "Ailes de ra√Ø√©e", en: "Raywings", de: "Rochen", da: "Skadevinger", es: "Alas del raya", pt: "Asas de airoga" },
  { no: "√òrret", fr: "Truite", en: "Trout", de: "Forelle", da: "√òrred", es: "Trucha", pt: "Truta" },
  { no: "√òrretfilet", fr: "Filet de truite", en: "Fillet of trout", de: "Leiste von forelle", da: "√òrredfilet", es: "Filete de trucha", pt: "Filete de truta" },
  // --- Dodatkowe popularne gatunki ---
  { no: "Brosme", fr: "Brosme", en: "Cusk/Tusk", de: "Lumb", da: "Brosme", es: "Brosmio", pt: "Bolota" },
  { no: "Makrell", fr: "Maquereau", en: "Mackerel", de: "Makrele", da: "Makrel", es: "Caballa", pt: "Cavala" },
  { no: "Makrellfilet", fr: "Filet de maquereau", en: "Fillet of mackerel", de: "Makrelenfilet", da: "Makrelfillet", es: "Filete de caballa", pt: "Filete de cavala" },
  { no: "Reke", fr: "Crevette", en: "Shrimp/Prawn", de: "Garnele", da: "Reje", es: "Gamba", pt: "Camar√£o" },
  { no: "Kongekrabbe", fr: "Crabe royal", en: "King Crab", de: "K√∂nigskrabbe", da: "Kongekrabbe", es: "Cangrejo real", pt: "Caranguejo real" },
  { no: "Krabbe", fr: "Crabe", en: "Crab", de: "Krabbe", da: "Krabbe", es: "Cangrejo", pt: "Caranguejo" },
  { no: "Hummer", fr: "Homard", en: "Lobster", de: "Hummer", da: "Hummer", es: "Langosta", pt: "Lagosta" },
  { no: "Sj√∏tunge", fr: "Sole", en: "Sole", de: "Seezunge", da: "Tunge", es: "Lenguado", pt: "Linguado" },
  { no: "Abbor", fr: "Perche", en: "Perch", de: "Barsch", da: "Aborre", es: "Perca", pt: "Perca" },
  { no: "Gjedde", fr: "Brochet", en: "Pike", de: "Hecht", da: "Gedde", es: "Lucio", pt: "L√∫cio" },
  { no: "Brasme", fr: "Br√®me", en: "Bream", de: "Brassen", da: "Brasen", es: "Brema", pt: "Brema" },
  { no: "Havabbor", fr: "Bar commun", en: "Sea Bass", de: "Wolfsbarsch", da: "Havbars", es: "Lubina", pt: "Robalo" },
  { no: "Dorade", fr: "Dorade royale", en: "Sea Bream", de: "Goldbrasse", da: "Dorade", es: "Dorada", pt: "Dourada" },
  { no: "Sardin", fr: "Sardine", en: "Sardine", de: "Sardine", da: "Sardin", es: "Sardina", pt: "Sardinha" },
  { no: "Ansjos", fr: "Anchois", en: "Anchovy", de: "Sardelle", da: "Ansjos", es: "Anchoa", pt: "Anchova" },
  { no: "Sverdfisk", fr: "Espadon", en: "Swordfish", de: "Schwertfisch", da: "Sv√¶rdfisk", es: "Pez espada", pt: "Espadarte" },
  { no: "Tunfisk", fr: "Thon", en: "Tuna", de: "Thunfisch", da: "Tunfisk", es: "At√∫n", pt: "Atum" },
  { no: "Bl√•finnig tunfisk", fr: "Thon rouge", en: "Bluefin Tuna", de: "Blauflossenthun", da: "Bl√•finnet tunfisk", es: "At√∫n rojo", pt: "Atum rabilho" },
  { no: "√Öl", fr: "Anguille", en: "Eel", de: "Aal", da: "√Öl", es: "Anguila", pt: "Enguia" },
  { no: "Hav√•l", fr: "Congre", en: "Conger eel", de: "Meeraal", da: "Hav√•l", es: "Congrio", pt: "Congro" },
  { no: "Sprott", fr: "Sprat", en: "Sprat", de: "Sprotte", da: "Brisling", es: "Espad√≠n", pt: "Espadilha" },
  { no: "Lodde", fr: "Capelan", en: "Capelin", de: "Kapelan", da: "Lodde", es: "Capel√°n", pt: "Capelim" },
  { no: "Seilet", fr: "Filet de lieu noir", en: "Fillet of saithe", de: "K√∂hlerfilet", da: "Sejfilet", es: "Filete de palero", pt: "Filete de escamudo" },
  { no: "Torskefilet", fr: "Filet de morue", en: "Fillet of cod", de: "Kabeljaufilet", da: "Torskefilet", es: "Filete de bacalao", pt: "Filete de bacalhau" },
  { no: "Klippfisk", fr: "Morue sal√©e s√©ch√©e", en: "Salted dried cod", de: "Klippfisch", da: "Klipfisk", es: "Bacalao salado seco", pt: "Bacalhau seco salgado" },
  { no: "T√∏rrfisk", fr: "Stockfisch", en: "Stockfish", de: "Stockfisch", da: "T√∏rfisk", es: "Bacalao seco", pt: "Bacalhau seco" },
  { no: "R√∏kt laks", fr: "Saumon fum√©", en: "Smoked salmon", de: "R√§ucherlachs", da: "R√∏get laks", es: "Salm√≥n ahumado", pt: "Salm√£o fumado" },
  { no: "Sj√∏kreps", fr: "Langoustine", en: "Langoustine/Norway lobster", de: "Kaisergranat", da: "Jomfruhummer", es: "Cigala", pt: "Lagostim" },
  { no: "Kamskjell", fr: "Coquille Saint-Jacques", en: "Scallop", de: "Jakobsmuschel", da: "Kammusling", es: "Vieira", pt: "Vieira" },
  { no: "Bl√•skjell", fr: "Moule", en: "Mussel", de: "Miesmuschel", da: "Bl√•musling", es: "Mejill√≥n", pt: "Mexilh√£o" },
  { no: "√òsters", fr: "Hu√Ætre", en: "Oyster", de: "Auster", da: "√òsters", es: "Ostra", pt: "Ostra" },
  { no: "Blekksprut", fr: "Calmar", en: "Squid", de: "Kalmar", da: "Bl√¶ksprutte", es: "Calamar", pt: "Lula" },
  { no: "Akkar", fr: "Encornet", en: "Squid (Atlantic)", de: "Tintenfisch", da: "Akkar", es: "Pota", pt: "Lula atl√¢ntica" },
  { no: "Steinkobbe", fr: "Loup atlantique tachet√©", en: "Spotted wolffish", de: "Gefleckter Katfisch", da: "Plettet havkat", es: "Perro del norte manchado", pt: "Gata pintada" },
  { no: "Havmus", fr: "Chim√®re", en: "Rabbitfish/Chimaera", de: "Seekatze", da: "Havmus", es: "Quimera", pt: "Quimera" },
  { no: "Sm√∏rflyndre", fr: "Fl√©tan du Groenland", en: "Greenland halibut", de: "Schwarzer Heilbutt", da: "Hellefisk", es: "Flet√°n negro", pt: "Alabote negro" },
  { no: "Rognkjeks", fr: "Lompe", en: "Lumpfish", de: "Lumpfisch", da: "Stenbider", es: "Cicl√≥ptero", pt: "Cicl√≥ptero" },
  { no: "Rognkall", fr: "Lompe m√¢le", en: "Lumpsucker", de: "Lumpfisch m√§nnlich", da: "Stenbider han", es: "Cicl√≥ptero macho", pt: "Cicl√≥ptero macho" },
];

const LANG_LABELS = {
  no: "üá≥üá¥ Norsk", fr: "üá´üá∑ Fran√ßais", en: "üá¨üáß English",
  de: "üá©üá™ Deutsch", da: "üá©üá∞ Dansk", es: "üá™üá∏ Espa√±ol", pt: "üáµüáπ Portugu√™s"
};
const LANG_KEYS = Object.keys(LANG_LABELS);

// Build fish list
document.getElementById('fish-count').textContent = FISH_DB.length;
const fishList = document.getElementById('fish-list');
FISH_DB.forEach((fish, i) => {
  const el = document.createElement('div');
  el.className = 'fish-item';
  el.innerHTML = `<div><div class="fish-item-name">${fish.no}</div><div class="fish-item-en">${fish.en}</div></div><span class="fish-item-arrow">‚Ä∫</span>`;
  el.onclick = () => showResult(fish, false);
  fishList.appendChild(el);
});

// Enter key
document.getElementById('search-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') doSearch();
});

function setState(name) {
  ['loading','found','ai-found','multiple','not-found','error','idle'].forEach(s => {
    document.getElementById('state-' + s).classList.add('hidden');
  });
  document.getElementById('state-' + name).classList.remove('hidden');

  const isIdle = name === 'idle';
  document.getElementById('btn-search').classList.toggle('hidden', !isIdle);
  document.getElementById('btn-clear').classList.toggle('hidden', isIdle);
}

function buildResultRows(fish, isAI) {
  const type = isAI ? 'ai' : 'db';
  return LANG_KEYS.map((lang, i) => {
    const val = fish[lang] || '‚Äî';
    const emptyClass = fish[lang] ? '' : ' empty';
    return `<div class="result-row">
      <span class="result-lang ${type}">${LANG_LABELS[lang]}</span>
      <span class="result-name${emptyClass}">${val}</span>
    </div>`;
  }).join('');
}

function showResult(fish, isAI) {
  if (isAI) {
    document.getElementById('result-ai').innerHTML = buildResultRows(fish, true);
    setState('ai-found');
  } else {
    document.getElementById('result-db').innerHTML = buildResultRows(fish, false);
    setState('found');
  }
}

async function searchOnline(name) {
  return { found: false };
}

async function doSearch() {
  const q = document.getElementById('search-input').value.trim().toLowerCase();
  if (!q) return;

  setState('loading');

  // 1. Exact match
  let found = null;
  for (const fish of FISH_DB) {
    for (const lang of LANG_KEYS) {
      if (fish[lang] && fish[lang].toLowerCase() === q) { found = fish; break; }
    }
    if (found) break;
  }

  // 2. Partial match
  if (!found) {
    const partials = FISH_DB.filter(fish =>
      LANG_KEYS.some(lang => fish[lang] && fish[lang].toLowerCase().includes(q))
    );
    if (partials.length === 1) {
      found = partials[0];
    } else if (partials.length > 1) {
      const multiList = document.getElementById('multi-list');
      multiList.innerHTML = '';
      partials.forEach(fish => {
        const el = document.createElement('div');
        el.className = 'multi-item';
        el.innerHTML = `<div class="multi-item-name">${fish.no}</div><div class="multi-item-sub">${fish.en} ¬∑ ${fish.fr} ¬∑ ${fish.de}</div>`;
        el.onclick = () => showResult(fish, false);
        multiList.appendChild(el);
      });
      setState('multiple');
      return;
    }
  }

  if (found) { showResult(found, false); return; }

  // 3. AI online search
  try {
    const aiData = await searchOnline(document.getElementById('search-input').value.trim());
    if (aiData && aiData.found) {
      showResult(aiData, true);
    } else {
      setState('not-found');
    }
  } catch(e) {
    setState('error');
  }
}

function doReset() {
  document.getElementById('search-input').value = '';
  setState('idle');
}
</script>
</body>
</html>
